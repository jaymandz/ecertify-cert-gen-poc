{% extends 'base/master.html' %}

{% block content %}
<div class="mb-4">
    <div class="tooltip tooltip-right" data-tip="To certificates list">
        <a class="btn btn-square" role="button"
          href="{{ url_for('certificates.index') }}">
            {% include 'heroicons/arrow-uturn-left.svg' %}
        </a>
    </div>
    <div class="tooltip tooltip-right" data-tip="Add a recipient">
        <a class="btn btn-square" role="button"
          href="{{ url_for('recipients.create', certificate_id=certificate.id) }}">
            {% include 'heroicons/user-plus.svg' %}
        </a>
    </div>
    <div class="tooltip tooltip-right" data-tip="Download as ZIP">
        <button class="btn btn-square">
            {% include 'heroicons/archive-box-arrow-down.svg' %}
        </button>
    </div>
    <div class="tooltip tooltip-right" data-tip="Edit">
        <a class="btn btn-square" role="button"
          href="{{ url_for('certificates.edit', id=certificate.id) }}">
            {% include 'heroicons/pencil-square.svg' %}
        </a>
    </div>
    <div class="tooltip tooltip-right" data-tip="Delete">
        <button class="btn btn-square">
            {% include 'heroicons/trash.svg' %}
        </button>
    </div>
</div>

<div class="card card-compact mb-4 overflow-y-auto shadow-lg">
<div class="card-body" style="height: calc((100vh - 296px) / 2)">
    <h2 class="card-title">{{ certificate.name }}</h2>
    <p>
        Issued on <span x-text="dbToHumanFriendlyDate('{{ certificate.issuance_date }}')"></span>
        at {{ certificate.issuance_locale }}.
    </p>

    <p>
    {% for field in certificate.fields %}
        <strong>{{ field.certificate_type_field.description }}</strong>
        {% if field.certificate_type_field.value_type.value == 'date' %}
        <span x-text="dbToHumanFriendlyDate('{{ field.value }}')"></span>
        {% elif field.certificate_type_field.value_type.value == 'text' %}
        {% if field.value %}{{ field.value }}{% else %}<em>None</em>{% endif %}
        {% endif %}
        <br>
    {% endfor %}
    </p>

    <p>{{ certificate.recipients|length }} recipient(s) listed below.</p>
</div>
</div>

<form class="flex gap-x-1 items-center mb-4">
    <input class="input input-bordered w-full" name="q"
      placeholder="Search recipients here." type="text"
      value="{{ request.args.get('q', '')}}">
    <button class="btn btn-square" type="submit">
        {% include 'heroicons/magnifying-glass.svg' %}
    </button>
</form>

<div class="flex justify-center mb-2">
    <div class="join">
        <a class="btn join-item" role="button">
            {% include 'heroicons/chevron-double-left.svg' %}
        </a>
        <a class="btn join-item" role="button">1</a>
        <a class="btn join-item" role="button">
            {% include 'heroicons/chevron-double-right.svg' %}
        </a>
    </div>
</div>

<div class="bg-base-300 mb-4 overflow-y-auto rounded-box"
  style="height: calc((100vh - 296px) / 2)">
<ul class="bg-base-300 menu rounded-box">
    {% for recipient in certificate.recipients %}
    <li>
        <a href="#">
            {{ recipient.last_name }}
        </a>
    </li>
    {% endfor %}
</ul>
</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript">
let dbToHumanFriendlyDate = (dbDate) => {
    return luxon.DateTime.fromISO(dbDate).toLocaleString(
        luxon.DateTime.DATE_FULL
    )
}
</script>
{% endblock scripts %}